
/*******************************************************************************
 *
 *	Program for solving Schrodinger equation in the case of isotropic harmonic
 * oscillator with Numerov method.
 *	Routines are defined in ../modules/numerov/numerov2.c
 *
 *	The program need as input arguments:
 *	- 
 *
 ******************************************************************************/
 
#define MAIN_PROGRAM

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "schrnumerov.h"

/* Maximum radius */
#define RMAX 5.0

/* "Normalization" constant */
#define N 1.0e-3

/* Increment and number of steps */
#define EMIN 0
#define DE 0.005
#define ESTEPS 2000

/* Step length */
#define H 1.0e-4

/* Proper frequency */
#define Omega 1.0

/* Potential */
double V (double r)
{	
	return 0.5*M*Omega*Omega*r*r;
}

/* Null function */
double null (double x)
{
	return 0;
}


int main (int argc, char *argv[])
{
	if(argc<2)
	{
		printf("Missing input parameters: please specify L (angular momentum)\n\n");
		exit(EXIT_FAILURE);
	}
	
	double r;
	double E = EMIN;
	int i, L;
	L = atoi(argv[1]);
	
	/* array in which are going to be saved the 3 points used in the algorithm
	 * and their initialization */
	double y[3];
		y[0] = N;	y[2] = 0;	y[1] = N;
		for(i=0; i<L+1; i++)
		{	y[0]*=H;	y[1]*=(2*H); }
	
	//FILE *output[ESTEPS];
	FILE *outboundary;
	char *out_file;
		out_file = malloc(100*sizeof(char));
		sprintf(out_file, "isotropic_HO/yRmaxE_%d.dat", L);
	outboundary	= fopen(out_file,"w");
	fprintf(outboundary,
		"#\n# Value of the radial part of the isotropic harmonic oscillator's solution\n# at the last point of the mesh as a function of the energy parameter.\n# Angular momentum (absolute value) quantum number L = %d\n#\n", L);
	
	for(i=0; i<ESTEPS; i++)
	{
		printf("\tStep %d of %d... ", i+1, ESTEPS);
		fflush(stdout);
		r = 2*H;
		while(r<RMAX)
		{
			evol(V, null, r, H, y, E, L);
			r += H;
		};
		
		fprintf(outboundary, "%e\t%e\t%lf\n", E, y[1], r);
		r = H;
		E += DE;
		printf("Done!\n");
	}
	
	fclose(outboundary);
	
	exit(EXIT_SUCCESS);
}

/*******************************************************************************
 * Problemi:
 * _ prendendo r = 0 come punto o anche r = H, la funzione Ksq (in numerov.c)
 *	 non Ã¨ definita, se L diverso da 0;
 * - ...
 ******************************************************************************/
